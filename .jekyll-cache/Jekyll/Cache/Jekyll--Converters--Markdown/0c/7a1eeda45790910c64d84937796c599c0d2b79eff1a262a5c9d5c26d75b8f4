I"®(<h1 id="ä»ä¸€ä¸ªç®€å•ä¾‹å­å¼€å§‹">ä»ä¸€ä¸ªç®€å•ä¾‹å­å¼€å§‹</h1>
<p>å‡è®¾æœ‰ä¸€ä¸ª MyActivity extends Activityï¼Œ
è®¾ç½®äº†å¸ƒå±€ setContentView( R.layout.activity_my ); 
activity_my.xml çš„æºç å¦‚ä¸‹ï¼š  <br />
<br /></p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre></td><td class="rouge-code"><pre><span class="cp">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span>
<span class="nt">&lt;LinearLayout</span> <span class="na">xmlns:android=</span><span class="s">"http://schemas.android.com/apk/res/android"</span>
    <span class="na">xmlns:app=</span><span class="s">"http://schemas.android.com/apk/res-auto"</span>
    <span class="na">xmlns:tools=</span><span class="s">"http://schemas.android.com/tools"</span>
    <span class="na">android:layout_width=</span><span class="s">"match_parent"</span>
    <span class="na">android:layout_height=</span><span class="s">"match_parent"</span>
    <span class="na">android:orientation=</span><span class="s">"vertical"</span>
    <span class="na">tools:context=</span><span class="s">".viewtest.MyActivity"</span><span class="nt">&gt;</span>
    
    <span class="nt">&lt;TextView</span>
        <span class="na">android:layout_width=</span><span class="s">"wrap_content"</span>
        <span class="na">android:layout_height=</span><span class="s">"wrap_content"</span> 
        <span class="na">android:text=</span><span class="s">"MyActivity"</span><span class="nt">/&gt;</span>

<span class="nt">&lt;/LinearLayout&gt;</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>å·²çŸ¥ä¸€ä¸ª Activity çš„æ ¹è§†å›¾æ˜¯ DecorViewï¼Œé‚£ä¹ˆ DecorView å†…çš„è§†å›¾ç»“æ„æ˜¯æ€æ ·çš„å‘¢ï¼Ÿ</p>

<p>å…ˆè¯´ç»“è®ºï¼Œç»“æ„å¦‚ä¸‹ï¼š</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre><span class="err">ç¬¬0å±‚ï¼šDecorView</span>
-ç¬¬1å±‚ï¼Œç¬¬1ä¸ªViewï¼šLinearLayout ï¼ˆscreen_simple.xmlï¼‰
<span class="gd">--ç¬¬2å±‚ï¼Œç¬¬1ä¸ªViewï¼šViewStub
--ç¬¬2å±‚ï¼Œç¬¬2ä¸ªViewï¼šFrameLayoutï¼ˆè£…è½½ activity_my.xml çš„çˆ¶å®¹å™¨ï¼Œid ä¸º contentï¼‰
---ç¬¬3å±‚ï¼Œç¬¬1ä¸ªViewï¼šLinearLayoutï¼ˆactivity_my.xmlï¼‰
----ç¬¬4å±‚ï¼Œç¬¬1ä¸ªViewï¼šTextView
</span></pre></td></tr></tbody></table></code></pre></div></div>
<p>å…¶ä¸­ï¼Œç¬¬3å±‚çš„ LinearLayoutï¼Œå°±æ˜¯ activity_my.xml çš„æ ¹è§†å›¾ï¼›
ç¬¬4å±‚çš„ TextViewï¼Œå°±æ˜¯ TextView(â€œMyActivityâ€)
<br />
è€Œç¬¬1å±‚å’Œç¬¬2å±‚çš„è§†å›¾ï¼Œ
å¯¹åº” R.layout.screen_simple å³ screen_simple.xml å¸ƒå±€æ–‡ä»¶ï¼Œä½äºï¼šæºç å·¥ç¨‹/framework/base/core/res/layout/ï¼Œ<br />
ä¸€ä¸ªä»¥ LinearLayout ä¸ºæ ¹çš„è§†å›¾ï¼Œå¸¦æœ‰ä¸¤ä¸ªå­è§†å›¾ï¼šViewStubï¼ŒFrameLayoutã€‚<br /></p>

<p>å¯ä»¥åœ¨æ­¤å¤„æºç æ‰¾åˆ°ç­”æ¡ˆï¼š</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
</pre></td><td class="rouge-code"><pre>// PhoneWinow ç±»
 protected ViewGroup generateLayout(DecorView decor) {

	//  ã€‚ã€‚ã€‚ çœç•¥
       
        // Inflate the window decor.

        int layoutResource;
        int features = getLocalFeatures();

	// åŠ è½½å¸ƒå±€ï¼Œæ ¹æ® features æ¥åˆ¤æ–­
        if ((features &amp; (1 &lt;&lt; FEATURE_SWIPE_TO_DISMISS)) != 0) {
            layoutResource = R.layout.screen_swipe_dismiss;
            setCloseOnSwipeEnabled(true);
        } else if ((features &amp; ((1 &lt;&lt; FEATURE_LEFT_ICON) | (1 &lt;&lt; FEATURE_RIGHT_ICON))) != 0) {
		 //  ã€‚ã€‚ã€‚ çœç•¥ 
        } else if ((features &amp; ((1 &lt;&lt; FEATURE_PROGRESS) | (1 &lt;&lt; FEATURE_INDETERMINATE_PROGRESS))) != 0
                &amp;&amp; (features &amp; (1 &lt;&lt; FEATURE_ACTION_BAR)) == 0) {
		 //  ã€‚ã€‚ã€‚ çœç•¥
        } else if ((features &amp; (1 &lt;&lt; FEATURE_CUSTOM_TITLE)) != 0) {
            // Special case for a window with a custom title.
            // If the window is floating, we need a dialog layout
		 //  ã€‚ã€‚ã€‚ çœç•¥
        } else if ((features &amp; (1 &lt;&lt; FEATURE_NO_TITLE)) == 0) {
            // If no other features and not embedded, only need a title.
            // If the window is floating, we need a dialog layout
            if (mIsFloating) {
		 //  ã€‚ã€‚ã€‚ çœç•¥
            } else {
                layoutResource = R.layout.screen_title;
            }
            // System.out.println("Title!");
        } else if ((features &amp; (1 &lt;&lt; FEATURE_ACTION_MODE_OVERLAY)) != 0) {
            layoutResource = R.layout.screen_simple_overlay_action_mode;
        } else {
            // Embedded, so no decoration is needed.
            layoutResource = R.layout.screen_simple;
            // System.out.println("Simple!");
        }

        mDecor.onResourcesLoaded(mLayoutInflater, layoutResource);

	ViewGroup contentParent = (ViewGroup)findViewById(ID_ANDROID_CONTENT);
        if (contentParent == null) {
            throw new RuntimeException("Window couldn't find content container view");
        }

	//  ã€‚ã€‚ã€‚ çœç•¥

	return contentParent;
    }
</pre></td></tr></tbody></table></code></pre></div></div>
<p>ä¸Šè¿°åŠ è½½çš„å¸ƒå±€æ–‡ä»¶éƒ½æ˜¯ç³»ç»Ÿå†…ç½®çš„ï¼Œå¸¸ç”¨çš„å¸ƒå±€æ–‡ä»¶æ˜¯è¿™ä¸¤ä¸ªï¼š
R.layout.screen_title å’Œ R.layout.screen_simpleï¼Œéƒ½ä½äº framework/base/core/res/layout/
<br />
R.layout.screen_simple çš„æºç ï¼š
<br /></p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre></td><td class="rouge-code"><pre>&lt;LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
    android:layout_width="match_parent"
    android:layout_height="match_parent"
    android:fitsSystemWindows="true"
    android:orientation="vertical"&gt;
    &lt;ViewStub android:id="@+id/action_mode_bar_stub"
              android:inflatedId="@+id/action_mode_bar"
              android:layout="@layout/action_mode_bar"
              android:layout_width="match_parent"
              android:layout_height="wrap_content" /&gt;
    &lt;FrameLayout
         android:id="@android:id/content"
         android:layout_width="match_parent"
         android:layout_height="match_parent"
         android:foregroundInsidePadding="false"
         android:foregroundGravity="fill_horizontal|top"
         android:foreground="?android:attr/windowContentOverlay" /&gt;
&lt;/LinearLayout&gt;
</pre></td></tr></tbody></table></code></pre></div></div>
<p>ä¸€ä¸ª LinearLayout çš„æ ¹è§†å›¾ï¼Œå¸¦æœ‰ä¸¤ä¸ªå­è§†å›¾ï¼šViewStubï¼ŒFrameLayoutã€‚
è€Œ FrameLayout å°±æ˜¯ è£…è½½ activity_my.xml çš„çˆ¶å®¹å™¨ï¼Œid ä¸º contentï¼Œ
å…¶å¼•ç”¨ç”± PhoneWinow#generateLayout å‡½æ•°åˆ›å»ºå¹¶è¿”å›ç»™å˜é‡ mContentParentï¼Œ
å¹¶é€šè¿‡ PhoneWinow#setContent å‡½æ•°ä¸­çš„è¯­å¥ ï¼š</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>	mLayoutInflater.inflate(layoutResID, mContentParent); 
</pre></td></tr></tbody></table></code></pre></div></div>
<p>æŠŠä¸Šè¿°çš„ activity_my.xml  è®¾ç½®ç»™ mContentParentã€‚</p>

<p><br />
æ¥ä¸‹æ¥ç†ä¸€ä¸‹ï¼Œä» Activity çš„ setContentView å‡½æ•°ï¼Œæ˜¯å¦‚ä½•æ„å»º DecorView å’Œå…¶å­è§†å›¾çš„ã€‚</p>
<h1 id="åˆ›å»º-decorview-çš„è°ƒç”¨é“¾">åˆ›å»º DecorView çš„è°ƒç”¨é“¾</h1>

<ul>
  <li>Activity#setContentView
    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>  getWindow().setContentView(layoutResID);
</pre></td></tr></tbody></table></code></pre></div>    </div>
  </li>
  <li>PhoneWinow#setContent
    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="rouge-code"><pre>      if (mContentParent == null) {
          installDecor();

  if (hasFeature(FEATURE_CONTENT_TRANSITIONS)) {
      // ã€‚ã€‚ã€‚
      } else {
          mLayoutInflater.inflate(layoutResID, mContentParent);
      }
</pre></td></tr></tbody></table></code></pre></div>    </div>
  </li>
  <li>PhoneWinow#installDecor
    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre></td><td class="rouge-code"><pre>      if (mDecor == null) {
      // ç”Ÿæˆ DecorView
          mDecor = generateDecor(-1);

  // ã€‚ã€‚ã€‚

      if (mContentParent == null) {
          // R.layout.screen_simple è®¾ç½®ä¸º mDecor
      // id ä¸º content çš„è§†å›¾å¼•ç”¨äº¤ç»™ mContentParent
          mContentParent = generateLayout(mDecor);
</pre></td></tr></tbody></table></code></pre></div>    </div>
  </li>
  <li>PhoneWinow#generateDecor ( return new DecorView )
    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>  return new DecorView(context, featureId, this, getAttributes());
</pre></td></tr></tbody></table></code></pre></div>    </div>
  </li>
  <li>PhoneWinow#generateLayout
    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre>  layoutResource = R.layout.screen_simple;
  mDecor.onResourcesLoaded(mLayoutInflater, layoutResource);
  ViewGroup contentParent = (ViewGroup)findViewById(ID_ANDROID_CONTENT);
  return contentParent;
</pre></td></tr></tbody></table></code></pre></div>    </div>
  </li>
</ul>

<p>è¯¦ç»†çš„è®²è§£ï¼Œå‚è€ƒï¼š
<a href="https://blog.csdn.net/nihaomabmt/article/details/85248700">è¯¥æ–‡ç« ï¼Œå¯¹ DecorView åŒºåŸŸåˆ’åˆ†æœ‰è®²è§£çš„</a></p>

:ET